<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fieldwork — Import</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
  body { font-family: -apple-system, sans-serif; background: #0F0F10; color: #E2E2E6; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
  .card { background: #16161A; border: 1px solid #2A2A30; border-radius: 12px; padding: 36px 32px; width: 480px; }
  h2 { font-size: 16px; font-weight: 600; margin-bottom: 6px; }
  p  { font-size: 13px; color: #6B6B78; margin-bottom: 24px; line-height: 1.5; }
  .preview { background: #1C1C21; border: 1px solid #2A2A30; border-radius: 8px; padding: 14px 16px; margin-bottom: 20px; font-size: 12px; color: #6B6B78; line-height: 1.8; }
  .preview span { color: #E2E2E6; font-weight: 500; }
  button { width: 100%; background: #5E6AD2; color: white; border: none; border-radius: 7px; padding: 11px; font-size: 13px; font-weight: 500; font-family: inherit; cursor: pointer; transition: background 0.12s; }
  button:hover { background: #6B78E0; }
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  .log { margin-top: 20px; font-size: 12px; line-height: 1.9; max-height: 220px; overflow-y: auto; }
  .log .ok   { color: #4CAF7D; }
  .log .err  { color: #E07878; }
  .log .info { color: #6B6B78; }
  .done-msg { margin-top: 16px; background: rgba(76,175,125,0.1); border: 1px solid rgba(76,175,125,0.3); color: #4CAF7D; border-radius: 6px; padding: 10px 14px; font-size: 13px; display: none; }
</style>
</head>
<body>
<div class="card">
  <h2>Import your tasks into Fieldwork</h2>
  <p>This will import your 3 clients and 9 tasks into Supabase under your logged-in account. It won't duplicate anything already there.</p>

  <div class="preview">
    <div>Clients: <span>Sublime, Noovo, Lemma</span></div>
    <div>Tasks: <span>9 cards across all columns</span></div>
  </div>

  <button id="importBtn" onclick="runImport()">Import now</button>
  <div class="log" id="log"></div>
  <div class="done-msg" id="doneMsg">✓ All done! <a href="/" style="color:#4CAF7D;">Go to Fieldwork →</a></div>
</div>

<script>
// ── Paste your Supabase credentials here (same as in your main app) ───────────
const SUPABASE_URL     = 'https://xdtswmevexfmnhzcuqsj.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhkdHN3bWV2ZXhmbW5oemN1cXNqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5NjEzMjksImV4cCI6MjA4NzUzNzMyOX0.qXUngq8Np59di25C7gF9vccJ2WytMpAw4tXw4rG4Tlc';

// ── Your exported data ────────────────────────────────────────────────────────
const IMPORT_DATA = {"clients":[{"id":"nds0jfw","name":"Sublime","color":"#2ac63c"},{"id":"nuzsh7r","name":"Noovo","color":"#e68428"},{"id":"tbi4ips","name":"Lemma","color":"#9a28e6"}],"cards":[{"id":"2alaatv","title":"Design email templates","client":"nds0jfw","status":"todo","priority":"low","due":"2026-03-13","notes":"","order":900},{"id":"tu6eiwn","title":"Design journey map for insurance product","client":"nds0jfw","status":"todo","priority":"high","due":"2026-03-13","notes":"","order":300},{"id":"rrwo2ek","title":"Collab with Thum on Guest accounts","client":"nds0jfw","status":"todo","priority":"low","due":"2026-02-27","notes":"","order":700},{"id":"luslc0o","title":"Explore new Sublime brand refresh","client":"nds0jfw","status":"todo","priority":"low","due":"2026-03-06","notes":"","order":800},{"id":"rt74fwi","title":"Create insurance competitive audit shopping matrix","client":"nds0jfw","status":"todo","priority":"high","due":"2026-02-27","notes":"","order":100},{"id":"d2kjwv4","title":"Wireframe Noovo Service page","client":"nuzsh7r","status":"todo","priority":"med","due":"2026-02-25","notes":"","order":500},{"id":"vyh3mo9","title":"Wireframe Noovo Help Center page","client":"nuzsh7r","status":"todo","priority":"high","due":"2026-02-25","notes":"","order":400},{"id":"jvl1kjl","title":"Wireframe Noovo Rental Page","client":"nuzsh7r","status":"todo","priority":"med","due":"2026-02-27","notes":"","order":600},{"id":"7w3mjsl","title":"Submit proposal for brand work","client":"tbi4ips","status":"todo","priority":"high","due":"2026-02-24","notes":"","order":200}]};

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

function log(msg, type='info') {
  const el = document.getElementById('log');
  el.innerHTML += `<div class="${type}">${msg}</div>`;
  el.scrollTop = el.scrollHeight;
}

// Old short IDs → new UUIDs mapping
const clientIdMap = {};

async function runImport() {
  const btn = document.getElementById('importBtn');
  btn.disabled = true;
  btn.textContent = 'Importing…';

  // Check auth
  const { data: { session } } = await sb.auth.getSession();
  if (!session) {
    log('⚠ Not signed in — please open fieldwork-two.vercel.app, sign in, then come back to this page.', 'err');
    btn.disabled = false; btn.textContent = 'Import now';
    return;
  }
  const userId = session.user.id;
  log(`Signed in as ${session.user.email}`, 'ok');

  // Import clients
  log('Importing clients…', 'info');
  for (const client of IMPORT_DATA.clients) {
    const newId = crypto.randomUUID();
    clientIdMap[client.id] = newId;
    const { error } = await sb.from('clients').upsert({
      id: newId, user_id: userId, name: client.name, color: client.color
    });
    if (error) log(`✕ Client "${client.name}": ${error.message}`, 'err');
    else log(`✓ Client: ${client.name}`, 'ok');
  }

  // Import cards
  log('Importing tasks…', 'info');
  for (const card of IMPORT_DATA.cards) {
    const { error } = await sb.from('cards').upsert({
      id: crypto.randomUUID(),
      user_id: userId,
      title: card.title,
      client_id: clientIdMap[card.client] || null,
      status: card.status,
      priority: card.priority,
      due: card.due || null,
      notes: card.notes || '',
      col_order: card.order,
    });
    if (error) log(`✕ Task "${card.title}": ${error.message}`, 'err');
    else log(`✓ Task: ${card.title}`, 'ok');
  }

  log('All done!', 'ok');
  document.getElementById('doneMsg').style.display = 'block';
  btn.textContent = 'Done ✓';
}
</script>
</body>
</html>
